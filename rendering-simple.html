<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8"/>

<title>render time!</title>

<script src="jquery-1.6.1.min.js"></script>
<script src="jquery.mousewheel.min.js"></script>
<script src="glMatrix-0.9.5.min.js"></script>

<script>
var vec4 = {};
vec4.create = function (vec) {
	var dest = new glMatrixArrayType(4);
	if (vec) {
		dest[0] = vec[0];
		dest[1] = vec[1];
		dest[2] = vec[2];
		dest[3] = (vec.length > 3) ? vec[3] : 1;
	}
	return dest;
}

// model ------------------------------

var	cube = {
	vertices: [
		-1, -1, -1,		 1, -1, -1,
		 1,  1, -1,		-1,  1, -1,
		-1, -1,  1,		 1, -1,  1,
		 1,  1,  1,		-1,  1,  1
	],
	indices: [
		0, 2, 1,	1, 2, 6,	4, 5, 6,
		0, 3, 2,	6, 5, 1,	6, 7, 4,
		2, 3, 6,	0, 7, 3,	0, 1, 5,
		6, 3, 7,	0, 4, 7,	0, 5, 4
	],
}
var	ape = {
	vertices: [
		-0.445312,0.15625,0.78125,0.351562,0.117188,0.804688,0.445312,0.15625,0.78125,0.351562,0.242188,0.828125,-0.351562,0.242188,0.828125,0.265625,0.15625,0.820312,-0.265625,0.15625,0.820312,0.265625,
		0.335938,0.820312,0.09375,-0.8125,0.640625,0,0.40625,0.601562,-0.210938,-0.226562,0.46875,-0.34375,-0.148438,-0.539062,0.726562,0,-0.070312,1.08594,0.273438,-0.390625,-1.1875,0.34375,-0.484375,-1.08594,
		0.273438,-0.390625,-1.3125,0.054688,-0.53125,-0.789062,-0.125,-0.328125,-0.59375,-0.125,-0.164062,0.640625,-0.007812,-0.429688,0.789062,-0.125,-0.328125,0.59375,-0.125,-0.164062,0.773438,-0.140625,-0.125,
		-0.859375,0.382812,-0.382812,-1.03906,-0.085938,-0.492188,1.3125,0.054688,-0.53125,0.859375,0.382812,-0.382812,-1.25,0.46875,-0.546875,-1.02344,0.4375,-0.484375,1.02344,0.4375,-0.484375,1.25,0.46875,-0.546875,
		-1.23438,0.507812,-0.421875,1.23438,0.507812,-0.421875,1.36719,0.296875,-0.5,-1.36719,0.296875,-0.5,-1.28125,0.054688,-0.429688,-1.35156,0.320312,-0.421875,1.03906,-0.085938,-0.492188,1.1875,0.34375,-0.484375,
		1.10938,0.210938,-0.390625,-1.10938,0.210938,-0.390625,1.05469,0.1875,-0.382812,-1.21094,0.085938,-0.484375,-1.04688,0,-0.421875,-0.9375,0.0625,-0.335938,-0.882812,-0.015625,-0.265625,1.04688,0,-0.421875,1,
		0.125,-0.367188,0.882812,-0.015625,-0.265625,-0.851562,0.015625,-0.320312,0.828125,0.078125,-0.320312,-0.84375,0.171875,-0.320312,0.890625,0.234375,-0.320312,-0.953125,0.289062,-0.34375,-0.890625,0.234375,
		-0.320312,-1.05469,0.1875,-0.382812,-1.01562,0.234375,-0.375,0.960938,0.171875,-0.351562,1.01562,0.234375,-0.375,-1,0.125,-0.367188,-0.960938,0.171875,-0.351562,0.9375,0.0625,-0.335938,-0.890625,0.109375,
		-0.328125,0.890625,0.109375,-0.328125,-0.882812,-0.023438,-0.210938,1.03906,0,-0.367188,1.21094,0.085938,-0.484375,-1.25781,0.242188,-0.492188,-1.1875,0.09375,-0.445312,1.1875,0.09375,-0.445312,1.25781,
		0.242188,-0.492188,-1.03906,0.328125,-0.414062,1.03906,0.328125,-0.414062,0.945312,0.304688,-0.289062,-0.8125,-0.015625,-0.273438,0.882812,-0.023438,-0.210938,0.8125,-0.015625,-0.320312,-0.8125,-0.015625,
		-0.320312,0.84375,0.015625,-0.273438,-0.828125,0.078125,-0.320312,0.851562,0.015625,-0.320312,-0.820312,0.085938,-0.273438,0.757812,0.09375,-0.273438,0.820312,0.085938,-0.273438,0.765625,0.09375,-0.320312,
		-0.765625,0.09375,-0.320312,-0.835938,0.171875,-0.273438,-0.890625,0.242188,-0.265625,0.890625,0.242188,-0.265625,0.835938,0.171875,-0.273438,0.84375,0.171875,-0.320312,0.953125,0.289062,-0.34375,-0.71875,
		0.039062,-0.1875,-0.859375,0.320312,-0.046875,0.71875,0.039062,-0.1875,-0.796875,0.203125,-0.210938,0.820312,0.328125,-0.203125,-0.945312,0.304688,-0.289062,0.921875,0.359375,-0.21875,0.84375,0.289062,
		-0.210938,0.796875,0.203125,-0.210938,-0.84375,0.015625,-0.273438,-0.757812,0.09375,-0.273438,-0.71875,-0.023438,-0.171875,0.8125,-0.015625,-0.273438,0.71875,-0.023438,-0.171875,-0.84375,0.289062,-0.210938,
		-0.921875,0.359375,-0.21875,-0.890625,0.40625,-0.234375,0.890625,0.40625,-0.234375,-0.734375,-0.046875,0.070312,-0.726562,0,-0.070312,0.734375,-0.046875,0.070312,-0.828125,-0.070312,-0.132812,-0.773438,
		-0.140625,-0.125,0.828125,-0.070312,-0.132812,1.01562,0.414062,-0.289062,-1.17188,0.359375,-0.4375,-1.1875,0.4375,-0.390625,-1.02344,0.34375,-0.359375,1.02344,0.34375,-0.359375,1.17188,0.359375,-0.4375,1.1875,
		0.4375,-0.390625,1.23438,0.25,-0.445312,-1.23438,0.25,-0.445312,-1.26562,0.289062,-0.40625,-1.21094,0.078125,-0.40625,1.26562,0.289062,-0.40625,-1.03125,-0.039062,-0.304688,1.03125,-0.039062,-0.304688,
		-1.03906,0,-0.367188,-1.03906,-0.101562,-0.328125,1.21094,0.078125,-0.40625,1.03906,-0.101562,-0.328125,1.28125,0.054688,-0.429688,1.35156,0.320312,-0.421875,-1.01562,0.414062,-0.289062,-1.02344,0.476562,
		-0.3125,1.02344,0.476562,-0.3125,-0.296875,-0.3125,-0.265625,0.429688,-0.195312,-0.210938,0.34375,-0.148438,-0.539062,-0.640625,-0.007812,-0.429688,-0.429688,-0.195312,-0.210938,-0.460938,0.4375,-0.703125,
		-0.335938,0.054688,-0.664062,0.335938,0.054688,-0.664062,-0.484375,0.023438,-0.546875,-0.617188,0.328125,-0.585938,0.773438,0.265625,-0.4375,0.484375,0.023438,-0.546875,0.4375,-0.09375,0.46875,-0.40625,
		-0.171875,0.148438,0.40625,-0.171875,0.148438,0.296875,-0.3125,-0.265625,-0.820312,0.328125,-0.203125,0.796875,0.617188,-0.117188,-0.726562,0.40625,0.335938,0.859375,0.320312,-0.046875,0.796875,0.5625,0.125,
		-0.773438,0.164062,0.375,-0.796875,0.40625,0.460938,0.796875,0.40625,0.460938,0.773438,0.164062,0.375,-0.460938,0.523438,0.429688,0,0.570312,0.570312,0.109375,0.460938,0.609375,-0.335938,0.6875,0.59375,
		0.195312,0.664062,0.617188,0,0.898438,0.289062,-0.679688,0.453125,0.492188,0.484375,0.554688,0.554688,-0.632812,0.453125,0.28125,0.460938,0.523438,0.429688,0.632812,0.453125,0.28125,-0.453125,0.851562,
		0.234375,0.453125,0.851562,0.234375,0.640625,0.703125,0.054688,0.640625,0.75,-0.195312,0.453125,0.867188,-0.382812,0.640625,0.679688,-0.445312,-0.453125,0.867188,-0.382812,-0.640625,0.679688,-0.445312,
		0.617188,0.328125,-0.585938,-0.773438,0.265625,-0.4375,0.796875,0.539062,-0.359375,-0.796875,0.539062,-0.359375,-0.796875,0.617188,-0.117188,-0.640625,0.703125,0.054688,-0.640625,0.75,-0.195312,-0.796875,
		0.5625,0.125,0.679688,0.453125,0.492188,0.726562,0.40625,0.335938,0,0.898438,-0.546875,0,0.5625,-0.851562,0.460938,0.4375,-0.703125,-0.453125,0.929688,-0.070312,0,0.984375,-0.078125,0.453125,0.929688,
		-0.070312,0,0.070312,-0.828125,-0.851562,0.234375,0.054688,0.851562,0.234375,0.054688,-0.179688,-0.414062,0.257812,0,-0.484375,0.28125,0,-0.460938,0.1875,-0.210938,-0.390625,0.164062,0.210938,-0.390625,
		0.164062,0,-0.382812,-0.351562,0,-0.195312,-0.671875,-0.203125,-0.171875,0.5,0.203125,-0.171875,0.5,-0.234375,-0.25,0.554688,0.257812,-0.3125,0.554688,-0.21875,-0.28125,0.429688,0.21875,-0.28125,0.429688,
		0.210938,-0.226562,0.46875,-0.234375,-0.351562,0.40625,0.3125,-0.4375,0.570312,0.234375,-0.351562,0.40625,-0.25,-0.5,0.390625,0.25,-0.5,0.390625,-0.164062,-0.945312,0.4375,-0.140625,-0.757812,0.367188,
		0.289062,-0.710938,0.382812,0.367188,-0.890625,0.53125,-0.328125,-0.914062,0.398438,-0.289062,-0.710938,0.382812,0.328125,-0.914062,0.398438,0,-0.976562,0.460938,0.164062,-0.945312,0.4375,0,-0.804688,0.34375,
		0.140625,-0.757812,0.367188,-0.125,-0.539062,0.359375,0,-0.570312,0.320312,0.125,-0.539062,0.359375,0.179688,-0.414062,0.257812,-0.4375,-0.09375,0.46875,0.4375,-0.140625,0.53125,-0.601562,0,0.414062,0.601562,
		0,0.414062,0.828125,0.148438,0.445312,-0.828125,0.148438,0.445312,-0.859375,0.429688,0.59375,-0.710938,0.484375,0.625,-0.492188,0.601562,0.6875,-0.484375,0.554688,0.554688,0.710938,0.484375,0.625,
		0.320312,0.757812,0.734375,0.335938,0.6875,0.59375,-0.195312,0.664062,0.617188,-0.0625,0.492188,0.75,-0.109375,0.460938,0.609375,0,0.429688,0.742188,0.171875,0.21875,0.78125,-0.195312,0.226562,0.75,-0.195312,
		0.296875,0.757812,0.195312,0.226562,0.75,-0.179688,0.296875,0.78125,-0.234375,0.359375,0.757812,0.195312,0.296875,0.757812,0.234375,0.359375,0.757812,-0.203125,0.171875,0.75,0.242188,0.125,0.757812,0.203125,
		0.171875,0.75,-0.242188,0.125,0.757812,0.375,0.085938,0.726562,-0.460938,0.117188,0.703125,-0.476562,0.101562,0.71875,-0.375,0.0625,0.742188,-0.375,0.085938,0.726562,0.375,0.0625,0.742188,0.460938,0.117188,
		0.703125,-0.554688,0.28125,0.671875,-0.546875,0.210938,0.671875,0.554688,0.28125,0.671875,0.546875,0.210938,0.671875,0.53125,0.335938,0.679688,-0.53125,0.335938,0.679688,0.421875,0.398438,0.773438,-0.414062,
		0.390625,0.75,0.414062,0.390625,0.75,-0.335938,0.40625,0.75,0.273438,0.421875,0.773438,0.335938,0.429688,0.757812,0.335938,0.40625,0.75,-0.28125,0.398438,0.765625,0.28125,0.398438,0.765625,-0.210938,0.375,
		0.78125,0.25,0.46875,0.757812,-0.273438,0.421875,0.773438,-0.335938,0.429688,0.757812,0.328125,0.476562,0.742188,-0.421875,0.398438,0.773438,0.429688,0.4375,0.71875,-0.5625,0.351562,0.695312,0.5625,0.351562,
		0.695312,0.601562,0.375,0.664062,0.585938,0.289062,0.6875,-0.625,0.1875,0.648438,-0.585938,0.289062,0.6875,0.640625,0.296875,0.648438,0.625,0.1875,0.648438,-0.578125,0.195312,0.679688,0.492188,0.0625,0.671875,
		0.578125,0.195312,0.679688,-0.492188,0.0625,0.671875,-0.375,0.015625,0.703125,0.476562,0.101562,0.71875,-0.226562,0.109375,0.78125,-0.1875,0.15625,0.773438,-0.164062,0.140625,0.75,0.226562,0.109375,0.78125,
		-0.164062,0.414062,0.773438,0.164062,0.414062,0.773438,0.210938,0.375,0.78125,-0.125,0.304688,0.765625,-0.171875,0.21875,0.78125,0.179688,0.296875,0.78125,0.164062,0.140625,0.75,0.1875,0.15625,0.773438,
		-0.046875,-0.851562,0.632812,0.046875,-0.851562,0.632812,0,-0.78125,0.65625,0,-0.773438,0.71875,-0.09375,-0.75,0.664062,-0.09375,-0.742188,0.726562,-0.09375,-0.820312,0.710938,0.09375,-0.75,0.664062,-0.09375,
		-0.8125,0.640625,0.046875,-0.867188,0.6875,0,-0.859375,0.632812,-0.046875,-0.867188,0.6875,0,-0.875,0.6875,-0.0625,-0.882812,0.695312,-0.117188,-0.835938,0.710938,0.117188,-0.835938,0.710938,0.09375,
		-0.742188,0.726562,0.09375,-0.820312,0.710938,0,-0.765625,0.734375,-0.203125,-0.1875,0.5625,0.234375,-0.25,0.554688,0.164062,-0.242188,0.710938,-0.257812,-0.3125,0.554688,-0.3125,-0.4375,0.570312,0.179688,
		-0.3125,0.710938,0.210938,-0.445312,0.710938,-0.179688,-0.3125,0.710938,-0.085938,-0.289062,0.742188,-0.164062,-0.242188,0.710938,-0.125,-0.226562,0.75,-0.101562,-0.148438,0.742188,0.101562,-0.148438,
		0.742188,0,-0.140625,0.742188,0,-0.289062,0.804688,0,-0.203125,0.828125,0.078125,-0.25,0.804688,-0.109375,-0.226562,0.828125,-0.09375,-0.273438,0.78125,0.132812,-0.226562,0.796875,-0.132812,-0.226562,0.796875,
		0.09375,-0.15625,0.8125,0.109375,-0.226562,0.828125,-0.046875,-0.148438,0.8125,-0.039062,-0.125,0.78125,-0.09375,-0.15625,0.8125,0.046875,-0.148438,0.8125,0,-0.1875,0.796875,0.039062,-0.125,0.78125,-0.078125,
		-0.25,0.804688,0,-0.320312,0.78125,0.085938,-0.289062,0.742188,0.09375,-0.273438,0.78125,0,-0.195312,0.75,0.109375,-0.132812,0.78125,-0.109375,-0.132812,0.78125,0.125,-0.226562,0.75,-0.117188,-0.6875,
		0.734375,0.117188,-0.6875,0.734375,0,-0.445312,0.75,0,-0.679688,0.734375,0.078125,-0.445312,0.75,0,-0.328125,0.742188,-0.265625,-0.820312,0.664062,-0.078125,-0.445312,0.75,-0.109375,-0.71875,0.734375,0.109375,
		-0.71875,0.734375,0.265625,-0.820312,0.664062,0.0625,-0.882812,0.695312,0,-0.890625,0.6875,0,-0.945312,0.640625,0.164062,-0.929688,0.632812,0,0.210938,0.765625,0.132812,0.210938,0.757812,0,0.351562,0.820312,
		-0.132812,0.210938,0.757812,0.125,0.304688,0.765625,0,0.046875,0.726562,0.203125,0.09375,0.742188,-0.125,-0.101562,0.8125,0.125,-0.101562,0.8125,0.375,0.015625,0.703125,0.398438,-0.046875,0.671875,0.617188,
		0.054688,0.625,-0.617188,0.054688,0.625,-0.640625,0.296875,0.648438,0.726562,0.203125,0.601562,-0.601562,0.375,0.664062,0.6875,0.414062,0.726562,-0.4375,0.546875,0.796875,-0.328125,0.476562,0.742188,-0.429688,
		0.4375,0.71875,0.4375,0.546875,0.796875,0.3125,0.640625,0.835938,-0.203125,0.617188,0.851562,0.203125,0.617188,0.851562,-0.101562,0.429688,0.84375,-0.25,0.46875,0.757812,0.101562,0.429688,0.84375,-0.15625,
		0.71875,0.757812,0.0625,0.492188,0.75,0.15625,0.71875,0.757812,-0.320312,0.757812,0.734375,-0.3125,0.640625,0.835938,0.492188,0.601562,0.6875,-0.6875,0.414062,0.726562,-0.742188,0.375,0.65625,0.742188,0.375,
		0.65625,-0.726562,0.203125,0.601562,0.859375,0.429688,0.59375,0.632812,-0.039062,0.539062,-0.398438,-0.046875,0.671875,-0.632812,-0.039062,0.539062,-0.4375,-0.140625,0.53125,0.203125,-0.1875,0.5625,-0.210938,
		-0.445312,0.710938,-0.25,-0.703125,0.6875,-0.351562,-0.695312,0.570312,0.351562,-0.695312,0.570312,0.25,-0.703125,0.6875,-0.367188,-0.890625,0.53125,0.234375,-0.914062,0.632812,0.328125,-0.945312,0.523438,
		-0.234375,-0.914062,0.632812,-0.179688,-0.96875,0.554688,-0.328125,-0.945312,0.523438,-0.164062,-0.929688,0.632812,0.179688,-0.96875,0.554688,0,-0.984375,0.578125,-0.476562,0.242188,0.773438,0.4375,0.164062,
		0.765625,-0.351562,0.132812,0.78125,-0.351562,0.117188,0.804688,0.273438,0.164062,0.796875,-0.242188,0.242188,0.796875,0.226562,0.242188,0.820312,-0.226562,0.242188,0.820312,-0.265625,0.335938,0.820312,
		0.242188,0.242188,0.796875,-0.351562,0.359375,0.78125,-0.351562,0.375,0.804688,0.351562,0.359375,0.78125,0.351562,0.375,0.804688,-0.445312,0.335938,0.78125,0.445312,0.335938,0.78125,-0.4375,0.328125,0.765625,
		-0.46875,0.242188,0.757812,0.46875,0.242188,0.757812,0.476562,0.242188,0.773438,-0.546875,0.4375,0.578125,0.5,0.390625,0.6875,0.5625,0.242188,0.671875,0.625,0.242188,0.5625,-0.351562,0.515625,0.617188,
		0.546875,0.4375,0.578125,-0.5,0.390625,0.6875,-0.351562,0.453125,0.71875,0.4375,0.328125,0.765625,-0.273438,0.328125,0.796875,0.351562,0.453125,0.71875,0.351562,0.515625,0.617188,0.15625,0.4375,0.648438,
		-0.15625,0.4375,0.648438,-0.078125,0.242188,0.65625,0.203125,0.390625,0.742188,0.078125,0.242188,0.65625,-0.203125,0.390625,0.742188,0.273438,0.328125,0.796875,-0.203125,0.09375,0.742188,-0.140625,0.242188,
		0.742188,0.15625,0.054688,0.648438,0.140625,0.242188,0.742188,-0.15625,0.054688,0.648438,-0.273438,0.164062,0.796875,-0.351562,0.03125,0.71875,0.351562,0.132812,0.78125,-0.351562,-0.023438,0.617188,-0.5,
		0.09375,0.6875,0.351562,0.03125,0.71875,0.351562,-0.023438,0.617188,0.546875,0.054688,0.578125,-0.546875,0.054688,0.578125,-0.625,0.242188,0.5625,0.5,0.09375,0.6875,-0.4375,0.164062,0.765625,-0.5625,0.242188,
		0.671875
	],
	indices: [
		3,2,467,448,0,4,1,2,3,4,0,451,3,5,1,451,6,4,3,454,5,6,455,4,3,7,454,455,456,4,3,461,7,456,459,4,3,463,461,459,462,4,3,467,463,462,448,4,327,321,8,328,320,324,9,166,165,165,251,9,214,206,153,152,205,
		213,151,210,215,10,209,236,146,150,141,11,147,145,12,105,94,92,103,111,72,13,38,14,15,71,30,33,25,16,34,27,17,142,18,17,18,114,21,19,20,21,20,22,17,23,184,17,184,142,149,26,20,149,20,19,108,155,23,155,
		184,23,149,96,26,96,109,26,16,27,28,16,28,24,29,30,25,29,25,37,17,24,23,24,28,23,29,37,26,37,20,26,28,137,23,137,108,23,109,138,26,138,29,26,27,31,28,31,137,28,138,32,29,32,30,29,34,36,27,36,31,27,32,135,
		30,135,33,30,16,35,34,35,36,34,135,134,33,134,25,33,24,131,35,24,35,16,134,133,37,134,37,25,17,114,131,17,131,24,133,22,20,133,20,37,40,15,14,40,14,67,38,13,39,38,39,70,55,40,42,40,67,42,70,39,66,39,41,
		66,59,55,43,55,42,43,66,41,46,41,47,46,44,59,43,44,43,45,46,47,61,46,61,48,44,45,49,45,77,49,76,48,80,48,61,80,51,62,79,51,79,85,50,63,90,50,90,84,62,51,60,51,54,60,52,90,57,90,63,57,56,60,53,60,54,53,
		52,57,91,57,58,91,56,53,71,56,71,15,72,91,58,72,58,13,40,55,15,55,56,15,58,41,13,41,39,13,55,59,60,55,60,56,57,47,41,57,41,58,59,44,60,44,62,60,63,61,57,61,47,57,44,49,62,49,79,62,50,80,63,80,61,63,43,
		130,45,130,64,45,75,65,48,65,46,48,42,68,43,68,130,43,65,69,46,69,66,46,67,124,42,124,68,42,69,123,66,123,70,66,14,117,124,14,124,67,123,121,38,123,38,70,71,119,117,71,117,14,121,120,72,121,72,38,53,97,
		119,53,119,71,120,73,91,120,91,72,45,64,74,45,74,77,104,75,48,104,48,76,77,74,101,77,101,49,78,104,76,78,76,80,49,101,79,101,81,79,83,78,50,78,80,50,79,81,85,81,102,85,82,83,84,83,50,84,85,102,86,85,86,
		51,89,82,84,89,84,90,51,86,54,86,87,54,88,89,52,89,90,52,54,87,97,54,97,53,73,88,52,73,52,91,92,111,95,111,93,95,158,12,100,12,94,100,106,95,155,95,93,155,158,100,96,100,99,96,87,106,97,106,107,97,98,99,
		73,99,88,73,86,95,87,95,106,87,99,100,88,100,89,88,92,95,102,95,86,102,89,100,82,100,94,82,101,92,102,101,102,81,82,94,78,82,78,83,103,92,74,92,101,74,78,94,104,94,105,104,74,64,113,74,113,103,115,75,
		104,115,104,105,107,106,155,107,155,108,96,99,98,96,98,109,111,110,200,111,200,93,201,112,12,201,12,158,113,114,103,114,18,103,21,22,105,22,115,105,103,18,111,18,110,111,112,21,12,21,105,12,97,107,136,97,
		136,119,116,98,73,116,73,120,117,119,118,119,136,118,116,120,122,120,121,122,124,117,125,117,118,125,122,121,127,121,123,127,68,124,126,124,125,126,127,123,132,123,69,132,130,68,126,130,126,128,132,69,65,
		132,65,129,64,130,128,64,128,113,129,65,75,129,75,115,113,128,131,113,131,114,133,129,115,133,115,22,128,126,131,126,35,131,134,132,133,132,129,133,126,125,35,125,36,35,135,127,134,127,132,134,125,118,36,
		118,31,36,32,122,135,122,127,135,118,136,137,118,137,31,138,116,122,138,122,32,107,108,136,108,137,136,138,109,116,109,98,116,147,11,143,11,139,143,154,141,140,141,150,140,147,143,142,143,18,142,21,140,
		19,140,150,19,147,148,145,148,144,145,195,183,146,183,150,146,147,142,148,142,184,148,149,19,183,19,150,183,213,10,236,213,236,152,151,215,214,151,214,153,152,236,238,152,238,110,239,151,153,239,153,112,
		143,152,18,152,110,18,112,153,21,153,140,21,143,139,152,139,205,152,206,154,153,154,140,153,187,186,155,186,184,155,149,185,96,185,156,96,187,155,93,187,93,190,158,96,156,158,156,159,190,93,200,190,200,
		157,201,158,159,201,159,192,200,160,157,160,161,157,162,163,192,163,201,192,164,245,251,164,251,165,166,171,173,166,173,165,167,249,245,249,251,245,166,168,171,168,248,171,175,164,169,164,165,169,165,173,
		169,173,176,169,172,170,164,170,245,164,171,191,173,191,174,173,172,164,175,172,175,188,176,173,174,176,174,177,188,175,196,188,196,189,198,176,177,198,177,178,189,196,181,189,181,182,179,198,178,179,178,
		180,182,181,144,182,144,148,195,179,180,195,180,183,182,148,186,148,184,186,149,183,185,183,180,185,186,187,189,186,189,182,178,156,185,178,185,180,187,190,188,187,188,189,177,159,156,177,156,178,190,157,
		172,190,172,188,174,192,159,174,159,177,157,161,170,157,170,172,191,162,192,191,192,174,144,181,193,144,193,194,193,179,195,193,195,194,181,196,197,181,197,193,197,198,179,197,179,193,196,175,197,175,169,
		197,169,176,197,176,198,197,145,144,199,144,194,199,194,195,199,195,146,199,110,238,160,110,160,200,163,239,112,163,112,201,205,202,213,202,216,213,218,235,214,235,206,214,202,205,204,202,204,203,204,206,
		235,204,235,203,205,139,207,205,207,204,207,154,206,207,206,204,139,11,207,11,208,207,208,141,207,141,154,207,11,145,208,145,199,208,199,146,208,146,141,208,236,209,432,209,339,432,433,210,237,210,151,
		237,10,211,209,211,339,209,433,340,210,340,215,210,213,216,342,216,343,342,217,218,212,218,214,212,10,213,211,213,342,211,212,214,340,214,215,340,219,436,343,219,343,216,217,437,220,217,220,218,232,219,
		202,219,216,202,218,220,235,220,234,235,221,225,222,225,226,222,223,227,231,227,229,231,232,222,226,232,226,219,223,231,234,223,234,220,226,439,436,226,436,219,437,224,223,437,223,220,225,444,439,225,439,
		226,224,441,227,224,227,223,221,443,444,221,444,225,441,446,229,441,229,227,228,447,443,228,443,221,446,447,228,446,228,229,222,230,221,230,228,221,228,230,229,230,231,229,232,233,222,233,230,222,230,233,
		231,233,234,231,202,203,232,203,233,232,233,203,234,203,235,234,236,432,431,236,431,238,429,237,151,429,151,239,238,431,241,238,241,160,240,429,239,240,239,163,160,241,161,241,242,161,428,240,162,240,163,
		162,161,242,243,161,243,170,246,428,162,246,162,191,170,243,245,243,244,245,423,246,171,246,191,171,245,244,167,244,421,167,247,423,248,423,171,248,167,421,249,421,418,249,420,247,168,247,248,168,249,418,
		250,249,250,251,419,420,168,419,168,166,251,250,252,251,252,9,252,419,166,252,166,9,261,309,316,261,316,254,253,319,263,253,263,256,254,316,257,254,257,255,317,253,256,317,256,259,255,257,287,255,287,258,
		314,317,259,314,259,260,264,308,309,264,309,261,319,311,262,319,262,263,269,268,264,268,308,264,311,270,262,270,265,262,266,267,269,267,268,269,270,307,265,307,271,265,273,302,267,273,267,266,307,304,275,
		307,275,271,272,299,273,299,302,273,304,297,275,297,274,275,277,294,299,277,299,272,297,295,276,297,276,274,279,292,277,292,294,277,295,278,276,278,280,276,281,290,279,290,292,279,278,283,280,283,284,280,
		285,289,290,285,290,281,283,282,286,283,286,284,258,287,289,258,289,285,282,314,260,282,260,286,287,312,416,287,416,289,288,313,314,288,314,282,289,416,409,289,409,290,291,288,282,291,282,283,290,409,410,
		290,410,292,293,291,283,293,283,278,292,410,294,410,406,294,296,293,295,293,278,295,294,406,299,406,404,299,300,296,297,296,295,297,299,404,298,299,298,302,301,300,297,301,297,304,302,298,305,302,305,267,
		303,301,304,303,304,307,267,305,306,267,306,268,400,303,307,400,307,270,268,306,487,268,487,308,397,400,270,397,270,311,308,487,309,487,310,309,318,397,319,397,311,319,257,315,287,315,312,287,313,395,314,
		395,317,314,316,394,315,316,315,257,395,392,253,395,253,317,309,310,394,309,394,316,392,318,319,392,319,253,320,330,322,320,322,324,322,330,321,322,321,327,322,323,324,323,325,324,336,323,327,323,322,327,
		324,325,326,324,326,328,337,336,327,337,327,8,328,326,331,328,331,320,329,337,8,329,8,321,320,331,330,331,332,330,332,329,330,329,321,330,331,333,388,331,388,332,388,387,329,388,329,332,326,334,333,326,
		333,331,387,335,337,387,337,329,325,384,334,325,334,326,335,385,336,335,336,337,323,338,325,338,384,325,385,338,336,338,323,336,348,398,339,348,339,211,433,399,341,433,341,340,348,211,346,211,342,346,212,
		340,344,340,341,344,346,342,434,342,343,434,217,212,345,212,344,345,434,383,346,383,347,346,370,380,344,380,345,344,346,347,348,347,349,348,375,370,341,370,344,341,348,349,350,348,350,398,351,375,341,351,
		341,399,398,350,352,398,352,396,352,351,399,352,399,396,368,353,354,368,354,356,354,353,355,354,355,361,364,356,362,356,354,362,354,361,365,361,360,365,368,356,359,368,359,357,358,361,355,358,355,371,356,
		364,359,364,374,359,373,360,358,360,361,358,364,362,363,364,363,374,367,365,360,367,360,373,362,354,366,362,366,363,366,354,365,366,365,367,368,357,353,357,369,353,369,371,353,371,355,353,357,347,369,347,
		381,369,381,370,369,370,371,369,363,366,352,372,366,352,366,367,352,374,363,350,363,352,350,352,367,351,367,373,351,359,374,349,374,350,349,351,373,375,373,358,375,357,359,349,357,349,347,375,358,371,375,
		371,370,376,384,379,384,338,379,338,385,379,385,377,379,378,383,379,383,376,379,377,380,379,380,378,379,378,381,383,381,347,383,370,381,380,381,378,380,435,382,384,435,384,376,385,386,438,385,438,377,376,
		383,434,376,434,435,345,380,377,345,377,438,442,334,382,334,384,382,385,335,386,335,440,386,445,333,334,445,334,442,335,387,390,335,390,440,389,388,333,389,333,445,387,388,389,387,389,390,394,310,391,310,
		396,391,396,318,391,318,392,391,391,393,315,391,315,394,395,393,391,395,391,392,393,415,315,415,312,315,313,417,395,417,393,395,396,310,487,396,487,398,397,318,396,397,396,399,430,398,487,430,487,306,397,
		399,401,397,401,400,403,430,305,430,306,305,400,401,303,401,402,303,427,403,298,403,305,298,303,402,301,402,405,301,425,427,404,427,298,404,301,405,300,405,426,300,424,425,406,425,404,406,300,426,296,426,
		407,296,408,424,410,424,406,410,296,407,293,407,411,293,422,408,409,408,410,409,293,411,291,411,412,291,422,409,416,422,416,413,288,291,412,288,412,414,413,416,415,416,312,415,313,288,417,288,414,417,393,
		252,415,252,250,415,419,252,417,252,393,417,415,250,413,250,418,413,420,419,414,419,417,414,413,418,422,418,421,422,247,420,412,420,414,412,422,421,244,422,244,408,423,247,412,423,412,411,408,244,424,244,
		243,424,246,423,407,423,411,407,424,243,425,243,242,425,428,246,426,246,407,426,425,242,427,242,241,427,240,428,405,428,426,405,427,241,431,427,431,403,429,240,405,429,405,402,403,431,430,431,432,430,237,
		429,401,429,402,401,430,432,339,430,339,398,433,237,401,433,401,399,435,434,343,435,343,436,217,345,438,217,438,437,382,435,436,382,436,439,437,438,386,437,386,224,442,382,439,442,439,444,224,386,440,224,
		440,441,445,442,443,442,444,443,441,440,446,440,390,446,389,445,447,445,443,447,446,390,447,390,389,447,448,465,503,448,503,0,449,466,467,449,467,2,0,503,450,0,450,451,494,449,2,494,2,1,451,450,492,451,
		492,6,452,494,1,452,1,5,6,492,453,6,453,455,457,452,5,457,5,454,455,453,456,453,477,456,486,457,7,457,454,7,456,477,459,477,458,459,460,486,461,486,7,461,459,458,462,458,464,462,476,460,463,460,461,463,
		462,464,448,464,465,448,466,476,467,476,463,467,504,465,474,465,464,474,476,466,469,466,470,469,501,504,468,504,474,468,469,470,473,470,471,473,468,474,472,474,475,472,478,469,479,469,473,479,474,464,475,
		464,458,475,460,476,478,476,469,478,475,458,485,458,477,485,486,460,483,460,478,483,472,475,481,475,485,481,483,478,480,478,479,480,481,485,482,485,488,482,490,483,484,483,480,484,485,477,453,485,453,488,
		457,486,483,457,483,490,488,453,487,453,492,487,452,457,397,457,490,397,482,488,491,488,487,491,397,490,489,490,484,489,491,487,493,491,493,495,497,397,489,497,489,498,487,492,450,487,450,493,494,452,397,
		494,397,497,493,450,503,493,503,496,449,494,497,449,497,502,495,493,496,495,496,500,502,497,498,502,498,499,500,496,504,500,504,501,470,502,499,470,499,471,496,503,465,496,465,504,466,449,502,466,502,470
	]
};

// settings ---------------------------

var	rotation = vec3.create([ .3, .4, 0 ]),
	translation = vec3.create([0, 0, -5]),
	defaultColor = vec3.create([ 200, 224, 255 ]);
	light = vec3.create([ -3, 2.5, -10 ]),
	model = ape;

// init -------------------------------

var	$canvas, canvas, cw, ch, ctx, touch = (typeof Touch == 'object');

$(function () {
	$canvas = $('canvas');
	canvas = $canvas[0];
	ctx = canvas.getContext('2d');
	modelView = mat4.create();
	loadModel(model);
	updateModelView();
	resize();
	$(window).resize(resize);
	$canvas.mousedown(mousedown);
	$canvas.mousewheel(zoom);
	$canvas.bind('touchstart', mousedown);
});

function resize () {
	var $doc = $(document);
	canvas.width = cw = $doc.width();
	canvas.height = ch = $doc.height();
	projection = mat4.perspective(70, cw / ch, .1, 100);
	draw();
}

// navigation -------------------------

var	prevMouse = {}, evt;

function mousedown (oevt) {
	evt = (touch) ? oevt.originalEvent.touches[0] : oevt;
	prevMouse.pageX = evt.pageX;
	prevMouse.pageY = evt.pageY;
	$canvas.bind('mousemove', (evt.which == 1) ? rotate : translate);
	$canvas.bind('mouseup', mouseup);
	$canvas.bind('mouseout', mouseup);
	$canvas.bind('touchmove', (touch && oevt.originalEvent.touches.length > 1) ? translate : rotate);
	$canvas.bind('touchend', mouseup);
	oevt.preventDefault();
}
function mouseup () {
	$canvas.unbind('mousemove', rotate);
	$canvas.unbind('mousemove', translate);
	$canvas.unbind('mouseup', mouseup);
	$canvas.unbind('mouseout', mouseup);
	$canvas.unbind('touchmove', rotate);
	$canvas.unbind('touchmove', translate);
	$canvas.unbind('touchend', mouseup);
}

function rotate (oevt) {
	evt = (touch) ? oevt.originalEvent.touches[0] : oevt;
	rotation[0] += 8 * (evt.pageY - prevMouse.pageY) / ch;
	rotation[1] += 8 * (evt.pageX - prevMouse.pageX) / cw
	prevMouse.pageX = evt.pageX;
	prevMouse.pageY = evt.pageY;
	updateModelView();
	draw();
}
function translate (oevt) {
	evt = (touch) ? oevt.originalEvent.touches[0] : oevt;
	translation[0] += 8 * (evt.pageX - prevMouse.pageX) / cw;
	translation[1] -= 8 * (evt.pageY - prevMouse.pageY) / ch;
	prevMouse.pageX = evt.pageX;
	prevMouse.pageY = evt.pageY;
	updateModelView();
	draw();
}
function zoom (evt, delta) {
	translation[2] += translation[2] / (((delta > 0) ? 1 : -1) * 20);
	updateModelView();
	draw();
}

// model loading ----------------------

var	triangles;

function loadModel (model) {
	triangles = [];
	for (var i = 0; i < model.indices.length; i += 3) {

		var t = {};

		var c = (model.colors) ? vec3.create(model.colors.slice(i, i + 3)) : defaultColor;
		t.vertices = [];
		for (var p = 0; p < 3; p++) {
			var index = model.indices[i + p] * 3;
			t.vertices[p] = vec4.create(model.vertices.slice(index, index + 3));
		}

		t.center = vec3.create(t.vertices[0]);
		vec3.add(t.center, t.vertices[1]);
		vec3.add(t.center, t.vertices[2]);
		vec3.scale(t.center, 1 / 3);

		t.normal = (model.normals) ? model.normals[i / 3] : vec3.normalize(
			vec3.cross(
				vec3.subtract(t.vertices[1], t.vertices[0], vec3.create()),
				vec3.subtract(t.vertices[2], t.vertices[0], vec3.create())
			)
		);

		var angle = Math.acos(vec3.dot(vec3.normalize(vec3.subtract(light, t.center, vec3.create())), t.normal)) / Math.PI;
		t.color = 'rgb(' + Math.floor(angle * c[0]) + ',' + Math.floor(angle * c[1]) + ',' + Math.floor(angle * c[2]) + ')';

		triangles.push(t);

	}
}

// rendering --------------------------

var	modelView, projection;

function updateModelView () {
	mat4.identity(modelView);
	mat4.translate(modelView, translation);
	mat4.rotateX(modelView, rotation[0]);
	mat4.rotateY(modelView, rotation[1]);
	mat4.rotateZ(modelView, rotation[2]);
	triangles.sort(zorder);
}

var	buffer = [ vec4.create(), vec4.create(), vec4.create() ], i, t;

function draw () {
	ctx.clearRect(0, 0, cw, ch);
	for (i = 0; i < triangles.length; i++) {
		t = triangles[i];
		if (modelView[2] * t.normal[0] + modelView[6] * t.normal[1] + modelView[10] * t.normal[2] >= 0) {
			mat4.multiplyVec4(projection, mat4.multiplyVec4(modelView, t.vertices[0], buffer[0]));
			mat4.multiplyVec4(projection, mat4.multiplyVec4(modelView, t.vertices[1], buffer[1]));
			mat4.multiplyVec4(projection, mat4.multiplyVec4(modelView, t.vertices[2], buffer[2]));
			ctx.fillStyle = t.color;
			ctx.beginPath();
			ctx.moveTo((buffer[0][0] / buffer[0][3] + .5) * cw, (buffer[0][1] / buffer[0][3] - .5) * -ch);
			ctx.lineTo((buffer[1][0] / buffer[1][3] + .5) * cw, (buffer[1][1] / buffer[1][3] - .5) * -ch);
			ctx.lineTo((buffer[2][0] / buffer[2][3] + .5) * cw, (buffer[2][1] / buffer[2][3] - .5) * -ch);
			ctx.closePath();
			ctx.fill();
 		}
	}
}

function zorder (t1, t2) {
	return modelView[ 2] * (t1.center[0] - t2.center[0]) +
	       modelView[ 6] * (t1.center[1] - t2.center[1]) +
	       modelView[10] * (t1.center[2] - t2.center[2]);
}

</script>

</head>
<body>

<canvas width="100" height="100" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%"></canvas>

</body>
</html>
